<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>員工打卡系統</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-r from-blue-100 to-indigo-100 flex items-center justify-center min-h-screen">
  <div id="app" class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg transform transition-all duration-300">
    <div class="flex justify-center gap-4 mb-6">
      <button id="lang-zh" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200" data-lang="zh">中文</button>
      <button id="lang-vi" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200" data-lang="vi">Tiếng Việt</button>
      <button id="lang-en" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200" data-lang="en">English</button>
    </div>
    <h1 id="title" class="text-3xl font-bold text-indigo-700 mb-6 text-center">員工打卡系統</h1>
    <div id="checkin-section" class="space-y-4">
      <input id="name" type="text" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="輸入姓名">
      <select id="location" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
        <option value="宏匯">宏匯</option>
      </select>
      <button id="checkin-btn" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700 transition-colors duration-200">上班打卡</button>
      <button id="checkout-btn" class="w-full bg-orange-600 text-white p-3 rounded-lg hover:bg-orange-700 transition-colors duration-200">下班打卡</button>
      <div id="checkin-status" class="mt-4 text-center font-medium hidden"></div>
    </div>
    <!-- 管理者頁面連結已移除 -->
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, query, where, orderBy, limit } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';
    import { getUserIP, getDeviceInfo, getIPWhitelist, handleCheckin } from '/js/functions.js';

    // Firebase 配置
    const firebaseConfig = {
      apiKey: "AIzaSyCv1ywEy0oaL8FNBLAEO-Ban5lMs26Y_gY",
      authDomain: "employee-checkin-system.firebaseapp.com",
      projectId: "employee-checkin-system",
      storageBucket: "employee-checkin-system.firebasestorage.app",
      messagingSenderId: "646412258577",
      appId: "1:646412258577:web:7f32d3c069c415c9b190b0"
    };

    // 初始化 Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db; // 將 db 暴露給 functions.js 使用

    // DOM 元素
    const nameInput = document.getElementById('name');
    const locationSelect = document.getElementById('location');
    const checkinBtn = document.getElementById('checkin-btn');
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkinStatus = document.getElementById('checkin-status');
    const langButtons = document.querySelectorAll('[data-lang]');

    // 語言切換
    const translations = {
      zh: {
        title: '員工打卡系統',
        name: '輸入姓名',
        location: '宏匯',
        checkin: '上班打卡',
        checkout: '下班打卡',
        success: '打卡成功！',
        fail: '打卡失敗：',
        ipError: '您的 IP 不在白名單內，無法打卡！',
        inputError: '請輸入姓名和選擇地點！',
        noCheckinRecord: '找不到今天的上班打卡記錄，是否忘記上班打卡？',
        confirmCheckout: '確認直接下班打卡',
        cancelCheckout: '取消'
      },
      vi: {
        title: 'Hệ thống chấm công nhân viên',
        name: 'Nhập tên',
        location: '宏匯',
        checkin: 'Chấm công vào',
        checkout: 'Chấm công ra',
        success: 'Chấm công thành công!',
        fail: 'Chấm công thất bại:',
        ipError: 'IP của bạn không nằm trong danh sách trắng, không thể chấm công!',
        inputError: 'Vui lòng nhập tên và chọn địa điểm!',
        noCheckinRecord: 'Không tìm thấy bản ghi chấm công vào hôm nay, bạn có quên chấm công vào không?',
        confirmCheckout: 'Xác nhận chấm công ra',
        cancelCheckout: 'Hủy'
      },
      en: {
        title: 'Employee Check-in System',
        name: 'Enter name',
        location: '宏匯',
        checkin: 'Check-in',
        checkout: 'Check-out',
        success: 'Check-in successful!',
        fail: 'Check-in failed:',
        ipError: 'Your IP is not in the whitelist, cannot check-in!',
        inputError: 'Please enter name and select location!',
        noCheckinRecord: 'No check-in record found for today, did you forget to check in?',
        confirmCheckout: 'Confirm check-out',
        cancelCheckout: 'Cancel'
      }
    };

    let currentLang = 'zh';

    function setLanguage(lang) {
      currentLang = lang;
      document.getElementById('title').textContent = translations[lang].title;
      nameInput.placeholder = translations[lang].name;
      locationSelect.options[0].text = translations[lang].location;
      document.getElementById('checkin-btn').textContent = translations[lang].checkin;
      document.getElementById('checkout-btn').textContent = translations[lang].checkout;
      checkinStatus.classList.add('hidden');
    }

    langButtons.forEach(button => {
      button.addEventListener('click', () => {
        setLanguage(button.dataset.lang);
      });
    });

    // 預設語言為中文
    setLanguage('zh');

    // 上班/下班打卡
    checkinBtn.addEventListener('click', async () => {
      await handleCheckin('checkin', nameInput.value, locationSelect.value, currentLang, checkinStatus);
    });

    checkoutBtn.addEventListener('click', async () => {
      await handleCheckin('checkout', nameInput.value, locationSelect.value, currentLang, checkinStatus);
    });
  </script>
</body>
</html>
